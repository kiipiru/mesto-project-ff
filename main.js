(()=>{"use strict";function t(){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-33/users/me",{headers:{authorization:"29815212-d12a-4e86-b346-3f523f6c96a0"}})}function e(t,e,o,r,c,u,i,a,s){var l=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),p=l.querySelector(".card__delete-button"),d=l.querySelector(".card__like-button"),f=l.querySelector(".card__image"),m=l.querySelector(".card__title"),_=l.querySelector(".card__like-counter");return _.textContent=r,m.textContent=t,f.src=e,f.alt=t,u?p.addEventListener("click",(function(){return n(l,o)})):p.remove(),c&&d.classList.add("card__like-button_is-active"),d.addEventListener("click",(function(){(function(t,e,n,o){return o?function(t){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-33/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:"29815212-d12a-4e86-b346-3f523f6c96a0"}})}(e).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(e){return t.classList.remove("card__like-button_is-active"),n.textContent=e.likes.length,!o})).catch((function(t){console.log(t)})):function(t){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-33/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"29815212-d12a-4e86-b346-3f523f6c96a0"}})}(e).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(e){return t.classList.add("card__like-button_is-active"),n.textContent=e.likes.length,!o})).catch((function(t){console.log(t)}))})(d,o,_,c).then((function(t){c=t}))})),f.addEventListener("click",(function(){return s(f.src,m.textContent)})),l}function n(t,e){(function(t){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-33/cards/".concat(t),{method:"DELETE",headers:{authorization:"29815212-d12a-4e86-b346-3f523f6c96a0"}})})(e).then((function(e){return e.ok&&t.remove(),Promise.reject(e.status)})).catch((function(t){console.log(t)}))}function o(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function r(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function c(t){"Escape"===t.key&&r(document.querySelector(".popup_is-opened"))}function u(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n),e.disabled=!1):(e.classList.add(n),e.disabled=!0)}function i(t,e){t.querySelector(e.buttonElement).classList.add(e.inactiveButtonClass),t.querySelectorAll(e.inputElement).forEach((function(t){t.classList.remove(e.inputElementErrorClass)}));var n=t.querySelector("".concat(e.inputElement,"-error"));n.classList.remove(e.errorElementActiveClass),n.textContent=""}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,u,i=[],a=!0,s=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;a=!1}else for(;!(a=(o=c.call(n)).done)&&(i.push(o.value),i.length!==e);a=!0);}catch(t){s=!0,r=t}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(s)throw r}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var l,p=document.querySelector(".places__list"),d=document.querySelector(".profile__add-button"),f=document.querySelectorAll(".popup"),m=document.querySelector(".popup_type_image"),_=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_edit-avatar"),v=document.querySelector(".popup_type_new-card"),y=document.querySelector(".popup__image"),b=document.querySelector(".popup__caption"),S=document.querySelector(".profile__edit-button"),E=document.querySelectorAll(".popup__close"),k=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),q=document.querySelector(".profile__image"),C=document.forms["new-place"],L=document.forms["edit-profile"],j=document.forms["new-avatar"],A=C.elements["place-name"],w=C.elements.link,x=L.elements.name,P=L.elements.description,T=j.elements.avatar,M=(document.querySelectorAll(".popup__form"),{buttonElement:".popup__button",inactiveButtonClass:"popup__button_disabled",inputElement:".popup__input",inputElementErrorClass:"popup__input_type_error",errorElementActiveClass:"popup__input-error-active"});function z(t,e){y.src=t,y.alt=e,b.textContent=e,o(m)}function O(t,e){t.textContent=e?"Сохранение...":"Сохранить"}f.forEach((function(t){t.classList.add("popup_is-animated")})),f.forEach((function(t){t.addEventListener("click",(function(t){!function(t){t.target.classList.contains("popup_is-opened")&&r(t.target)}(t)}))})),L.addEventListener("submit",(function(t){t.preventDefault(),O(L.querySelector(".popup__button"),!0),function(t,e){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-33/users/me",{method:"PATCH",headers:{authorization:"29815212-d12a-4e86-b346-3f523f6c96a0","Content-Type":"application/json"},body:JSON.stringify({name:t,about:e})})}(x.value,P.value).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){k.textContent=t.name,g.textContent=t.about})).catch((function(t){return console.log(t)})).finally((function(){return O(L.querySelector(".popup__button"),!1)})),r(_)})),C.addEventListener("submit",(function(t){!function(t){var o,c;t.preventDefault(),O(C.querySelector(".popup__button"),!0),(o=A.value,c=w.value,fetch("https://mesto.nomoreparties.co/v1/wff-cohort-33/cards",{method:"POST",headers:{authorization:"29815212-d12a-4e86-b346-3f523f6c96a0","Content-Type":"application/json"},body:JSON.stringify({name:o,link:c})})).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){p.prepend(e(t.name,t.link,t._id,t.likes.length,t.likes.some((function(t){return t._id.includes(profileData._id)})),n))})).then((function(){r(v),C.reset(),i(C,M)})).catch((function(t){console.log(t)})).finally((function(){O(C.querySelector(".popup__button"),!1)}))}(t)})),E.forEach((function(t){t.addEventListener("click",(function(){r(t.closest(".popup"))}))})),S.addEventListener("click",(function(){i(L,M),o(_),x.value=k.textContent,P.value=g.textContent})),d.addEventListener("click",(function(){o(v)})),q.addEventListener("click",(function(){o(h),console.log(q.style.backgroundImage)})),l={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error-active"},Array.from(document.querySelectorAll(l.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);u(n,o,e.inactiveButtonClass),n.forEach((function(r){r.addEventListener("input",(function(){(function(t,e,n,o){var r={patternMismatch:e.dataset.patternMismatchErrorMessage,valueMissing:e.dataset.emptyInputErrorMessage,typeMismatch:"url"===e.type?e.dataset.notUrlErrorMessage:""},c=Object.keys(r).find((function(t){return e.validity[t]}));e.setCustomValidity(c?r[c]:""),e.validity.valid?function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));r?(e.classList.remove(n),r.textContent="",r.classList.remove(o)):console.error("Error element for ".concat(e.id," not found"))}(t,e,n,o):function(t,e,n,o,r){var c=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o),c.textContent=n,c.classList.add(r)}(t,e,e.validationMessage,n,o)})(t,r,e.inputErrorClass,e.errorClass),u(n,o,e.inactiveButtonClass)}))}))}(t,l)})),t().then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){k.textContent=t.name,g.textContent=t.about,q.style.backgroundImage="url(".concat(t.avatar,")")})).catch((function(t){console.log(t)})),j.addEventListener("submit",(function(t){var e;t.preventDefault(),O(j.querySelector(".popup__button"),!0),(e=T.value,fetch("https://mesto.nomoreparties.co/v1/wff-cohort-33/users/me/avatar",{method:"PATCH",headers:{authorization:"29815212-d12a-4e86-b346-3f523f6c96a0","Content-Type":"application/json"},body:JSON.stringify({avatar:e})})).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){q.style.backgroundImage="url(".concat(t.avatar,")")})).catch((function(t){console.log(t)})).finally((function(){O(j.querySelector(".popup__button"),!1)})),r(h),j.reset()})),Promise.all([t(),fetch("https://mesto.nomoreparties.co/v1/wff-cohort-33/cards",{headers:{authorization:"29815212-d12a-4e86-b346-3f523f6c96a0"}})]).then((function(t){var e=a(t,2),n=e[0],o=e[1];return n.ok&&o.ok?Promise.all([n.json(),o.json()]):Promise.reject("".concat(n.status,", ").concat(o.status))})).then((function(t){var n=a(t,2),o=n[0];n[1].forEach((function(t){var n=e(t.name,t.link,t._id,t.likes.length,t.likes.some((function(t){return t._id.includes(o._id)})),t.owner._id===o._id,0,0,z);p.append(n)}))})).catch((function(t){console.log(t)}))})();